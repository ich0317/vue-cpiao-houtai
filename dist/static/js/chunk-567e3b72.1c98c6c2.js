(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-567e3b72"],{"0900":function(t,e,s){},"152d":function(t,e,s){"use strict";var r=s("0900"),a=s.n(r);a.a},5109:function(t,e,s){},6997:function(t,e,s){"use strict";var r=s("5109"),a=s.n(r);a.a},"7fb7":function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"createseat"}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"pan-box"},[s("div",{staticClass:"pan-form"},[s("el-form",{staticClass:"demo-form-inline",attrs:{inline:""}},[s("el-form-item",[s("el-button",{attrs:{type:"success",size:"medium"},on:{click:t.addScreen}},[t._v("添加影厅")])],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"info",size:"medium"},on:{click:t.createSeats}},[t._v("创建座位图")])],1)],1)],1)])])],1),t._v(" "),s("div",{staticClass:"map-box"},[s("div",{staticClass:"screen-name-bar"},t._l(t.allScreenInfo,function(e,r){return s("span",{key:r,class:{active:t.currentScreenId==e._id},on:{click:function(s){return t.changeScreen(e._id)}}},[t._v(t._s(e.screen_name))])}),0),t._v(" "),s("div",{staticClass:"screen-name-show"},t._l(t.allScreenInfo,function(e,r){return e._id==t.currentScreenId?s("span",{key:r},[t._v(t._s(e.screen_name))]):t._e()}),0),t._v(" "),s("div",{staticClass:"content-box maps"},[s("table",{staticStyle:{display:"inline-block"},attrs:{width:"auto"}},[s("tr",[s("td",{attrs:{width:"40",height:"34"}},[t._v(" ")]),t._v(" "),s("td",t._l(t.markCol,function(e,r){return s("span",{key:r,staticClass:"mark-col",style:{opacity:0==e.is_show?"0":"1"}},[t._v(t._s(e.k))])}),0)]),t._v(" "),s("tr",[s("td",t._l(t.markRow,function(e,r){return s("span",{key:r,staticClass:"mark-row",style:{opacity:0==e.is_show?"0":"1"}},[t._v(t._s(e.k))])}),0),t._v(" "),s("td",t._l(t.seatArr,function(e,r){return s("div",{key:r,staticClass:"row-cloumn"},t._l(e,function(e,r){return s("span",{key:r,staticClass:"col-cloumn",style:{opacity:0==e.is_show?"0":"1"},attrs:{"data-_x":e.graph_col,"data-_y":e.graph_row,"data-_fixed_x":e.fixed_x,"data-_fixed_y":e.fixed_y},on:{click:function(e){return t.drawSeat(e)}}},[t._v(t._s(e.seat_row)+"排"+t._s(e.seat_col))])}),0)}),0)])])])]),t._v(" "),s("div",{staticStyle:{position:"absolute",left:"20px",bottom:"40px"}},[s("goBack"),t._v(" "),s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.submitSeat}},[t._v("保存")])],1),t._v(" "),s("inputBox",{attrs:{isBoxShow:t.isScreenBox,title:t.boxTitle},on:{"update:isBoxShow":function(e){t.isScreenBox=e},"update:is-box-show":function(e){t.isScreenBox=e},hideBox:t.dataHide}},[s("div",{directives:[{name:"show",rawName:"v-show",value:0==t.isSeatOrScreen,expression:"isSeatOrScreen == 0"}],staticClass:"form-wrap"},[s("el-form",{attrs:{"label-position":"right","label-width":"100px"}},[s("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"影厅名称"}},[s("el-input",{attrs:{size:"medium"},model:{value:t.screenInfo.screen_name,callback:function(e){t.$set(t.screenInfo,"screen_name",e)},expression:"screenInfo.screen_name"}})],1),t._v(" "),s("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"影厅类型"}},[s("el-select",{attrs:{size:"medium",placeholder:"请选择"},model:{value:t.screenInfo.screen_type,callback:function(e){t.$set(t.screenInfo,"screen_type",e)},expression:"screenInfo.screen_type"}},[s("el-option",{attrs:{label:"普通",value:"普通"}}),t._v(" "),s("el-option",{attrs:{label:"旗舰",value:"旗舰"}})],1)],1),t._v(" "),s("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"音响类型",placeholder:"请选择"}},[s("el-select",{attrs:{size:"medium"},model:{value:t.screenInfo.sound_type,callback:function(e){t.$set(t.screenInfo,"sound_type",e)},expression:"screenInfo.sound_type"}},[s("el-option",{attrs:{label:"普通",value:"普通"}}),t._v(" "),s("el-option",{attrs:{label:"高端",value:"高端"}})],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"状态"}},[s("el-switch",{attrs:{size:"medium"},model:{value:t.screenInfo.screen_status,callback:function(e){t.$set(t.screenInfo,"screen_status",e)},expression:"screenInfo.screen_status"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.submitScreen}},[t._v("添加")]),t._v(" "),s("el-button",{attrs:{size:"medium"},on:{click:t.cancelScreen}},[t._v("取消")])],1)],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:1==t.isSeatOrScreen,expression:"isSeatOrScreen == 1"}],staticClass:"form-wrap"},[s("el-form",{attrs:{"label-position":"right","label-width":"100px"}},[s("el-form-item",{attrs:{label:"座位布局"}},[s("el-row",[s("el-col",{attrs:{span:9}},[s("el-input",{attrs:{size:"medium"},model:{value:t.seatInit.row,callback:function(e){t.$set(t.seatInit,"row",e)},expression:"seatInit.row"}})],1),t._v(" "),s("el-col",{attrs:{span:3}},[t._v("  排")]),t._v(" "),s("el-col",{attrs:{span:9}},[s("el-input",{attrs:{size:"medium"},model:{value:t.seatInit.col,callback:function(e){t.$set(t.seatInit,"col",e)},expression:"seatInit.col"}})],1),t._v(" "),s("el-col",{attrs:{span:3}},[t._v("  列")])],1)],1),t._v(" "),s("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"座位排序",placeholder:"请选择"}},[s("el-select",{attrs:{size:"medium"},model:{value:t.seatInit.rowSort,callback:function(e){t.$set(t.seatInit,"rowSort",e)},expression:"seatInit.rowSort"}},[s("el-option",{attrs:{label:"从上至下",value:"tb"}}),t._v(" "),s("el-option",{attrs:{label:"从下至上",value:"bt"}})],1)],1),t._v(" "),s("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"座位列序",placeholder:"请选择"}},[s("el-select",{attrs:{size:"medium"},model:{value:t.seatInit.colSort,callback:function(e){t.$set(t.seatInit,"colSort",e)},expression:"seatInit.colSort"}},[s("el-option",{attrs:{label:"从左至右",value:"lr"}}),t._v(" "),s("el-option",{attrs:{label:"从右至左",value:"rl"}})],1)],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.initMap}},[t._v("确定")]),t._v(" "),s("el-button",{attrs:{size:"medium"},on:{click:t.cancelScreen}},[t._v("取消")])],1)],1)],1)])],1)},a=[],n=s("e20c"),o=(s("f763"),s("7364"),s("4453"),s("089b")),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.isBoxShow?s("div",{staticClass:"input-box-shade"},[s("div",{staticClass:"input-box"},[s("div",{staticClass:"input-title-bar"},[t._v(t._s(t.title)),s("i",{staticClass:"input-box-close el-message-box__close el-icon-close",on:{click:t.closeBox}})]),t._v(" "),s("div",{staticClass:"input-wrap"},[t._t("default")],2)])]):t._e()},c=[],l={data:function(){return{}},props:{isBoxShow:{type:Boolean,default:!1},title:{type:String,default:"提示"}},methods:{closeBox:function(){this.$emit("hideBox",!1)}},mounted:function(){}},u=l,h=(s("152d"),s("17cc")),_=Object(h["a"])(u,i,c,!1,null,"b12687a2",null),f=_.exports,d=s("b775");function m(t){return Object(d["a"])({url:"/api/addScreen",method:"post",data:t})}function p(t){return Object(d["a"])({url:"/api/getScreen",method:"get",params:t})}function v(t){return Object(d["a"])({url:"/api/addSeat",method:"post",data:t})}function w(t){return Object(d["a"])({url:"/api/getSeat",method:"post",data:t})}var b=function(t){var e=t.row,s=t.col,r=t.rowSort,a=t.colSort,n=t.screen_id,o=r+a,i=[],c=[];switch(o){case"tblr":return l();case"tbrl":return u();case"btlr":return h();case"btrl":return _()}function l(){var t={},r=null,a=null;for(r=0;r<e;r++){var o=[];for(i.push({k:r+1,is_show:1}),a=0;a<s;a++)o.push({seat_col:a+1,seat_row:r+1,graph_col:a,graph_row:r,fixed_x:r+1,fixed_y:a+1,seat_status:0,is_show:1,screen_id:n}),c.push({k:a+1,is_show:1});t[r]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}function u(){var t={},r=null,a=null;for(r=0;r<e;r++){var o=[];for(i.push({k:r+1,is_show:1}),a=s;a>0;a--)o.push({seat_col:a,seat_row:r+1,graph_col:s-a,graph_row:r,fixed_x:r+r+1,fixed_y:a+a,seat_status:0,is_show:1,screen_id:n}),c.push({k:a,is_show:1});t[r]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}function h(){var t={},r=null,a=null;for(r=e;r>0;r--){var o=[];for(i.push({k:r,is_show:1}),a=0;a<s;a++)o.push({seat_col:a+1,seat_row:r,graph_col:a,graph_row:e-r,fixed_x:r,fixed_y:a+1,seat_status:0,is_show:1,screen_id:n}),c.push({k:a+1,is_show:1});t[e-r]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}function _(){var t={},r=null,a=null;for(r=e;r>0;r--){var o=[];for(i.push({k:r,is_show:1}),a=s;a>0;a--)o.push({seat_col:a,seat_row:r,graph_col:s-a,graph_row:e-r,fixed_x:r,fixed_y:a,seat_status:0,is_show:1,screen_id:n}),c.push({k:a,is_show:1});t[e-r]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}},k=function(t,e){var s={};return t.reduce(function(t,r){return!s[r[e]]&&(s[r[e]]=t.push(r)),t},[])},S=(s("ed08"),s("a3ba")),g={components:{inputBox:f,goBack:S["a"]},data:function(){return{listLoading:!0,isScreenBox:!1,boxTitle:"提示",screenInfo:{screen_name:"",screen_type:"",sound_type:"",screen_status:!0,cinema_id:""},allScreenInfo:[],cinema_id:"",currentScreenId:"",isSeatOrScreen:null,seatInit:{row:5,col:4,rowSort:"tb",colSort:"lr",screen_id:""},seatArr:[],markCol:[],markRow:[]}},mounted:function(){this.cinema_id=this.$route.query.cinema_id||"",this.getScreenList()},methods:{addScreen:function(){this.isSeatOrScreen=0,this.isScreenBox=!0,this.screenInfo.cinema_id=this.cinema_id},cancelScreen:function(){this.isScreenBox=!1},dataHide:function(t){this.isScreenBox=t},submitScreen:function(){var t=this;m(this.screenInfo).then(function(e){var s=e.msg;e.data;for(var r in t.cancelScreen(),t.getScreenList(),t.screenInfo)"screen_status"!=r&&(t.screenInfo[r]="");t.$message({message:s,type:"success"})})},getScreenList:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p({cinema_id:this.cinema_id}).then(function(t){var s=t.data,r=t.code,a=t.msg;1==r?e.$message({message:a,type:"error"}):(e.allScreenInfo=s.screen,e.currentScreenId=e.seatInit.screen_id=s.screen[0]._id,e.formatSeat(s.seat))});case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),createSeats:function(){this.isSeatOrScreen=1,this.isScreenBox=!0},initMap:function(){var t=b(this.seatInit);this.seatArr=t.seats,this.markCol=t.markCol,this.markRow=t.markRow,this.cancelScreen()},drawSeat:function(t){var e=this,s=this.seatInit.rowSort+this.seatInit.colSort,r=t.target.dataset,a=r._x,n=r._y,o=this.seatArr[n][a];o.is_show=0==o.is_show?1:0;var i=this.seatArr[n].filter(function(t){return 1==t.is_show});0==i.length?this.markRow[n].is_show=0:this.markRow[n].is_show=1;var c=0;for(var l in this.seatArr)1==this.seatArr[l][a].is_show&&c++;this.markCol[a].is_show=0==c?0:1;var u=this.markCol.filter(function(t){return 1==t.is_show}),h={tb:function(){var t=this.markRow.filter(function(t){return 1==t.is_show});t.forEach(function(t,e){t.k=e+1})},bt:function(){var t=this.markRow.filter(function(t){return 1==t.is_show});t.forEach(function(e,s){e.k=t.length-s})},lr:function(){i.forEach(function(t,e){t.seat_col=e+1}),u.forEach(function(t,e){t.k=e+1})},rl:function(){i.forEach(function(t,e){t.seat_col=i.length-e}),u.forEach(function(t,e){t.k=u.length-e})}};switch(s){case"tblr":h.tb.call(this),h.lr.call(this);break;case"tbrl":h.tb.call(this),h.rl.call(this);break;case"btlr":h.bt.call(this),h.lr.call(this);break;case"btrl":h.bt.call(this),h.rl.call(this);break}this.markRow.forEach(function(t,s){e.seatArr[s].forEach(function(e,s){e.seat_row=t.k})})},submitSeat:function(){var t=this,e=[];for(var s in this.seatArr)this.seatArr[s].forEach(function(e){e.fixed_y=t.markCol[e.graph_col].k,e.fixed_x=t.markRow[e.graph_row].k}),e=e.concat(this.seatArr[s]);v({seat:e}).then(function(e){var s=e.msg,r=e.data;t.formatSeat(r),t.$message({message:s,type:"success"})})},formatSeat:function(t){var e=[],s=[],r={},a={},o={};t.forEach(function(t,n){r[t.graph_row]?r[t.graph_row].push(t):r[t.graph_row]=[t],void 0===a[t.graph_row]?1==t.is_show?(a[t.graph_row]=1,e.push({k:t.fixed_x})):(a[t.graph_row]=0,e.push({k:t.fixed_x})):(1==t.is_show&&a[t.graph_row]++,e[t.graph_row].is_show=a[t.graph_row]?1:0),void 0===o[t.graph_col]?1==t.is_show?(o[t.graph_col]=1,s.push({k:t.fixed_y})):(o[t.graph_col]=0,s.push({k:t.fixed_y})):(1==t.is_show&&o[t.graph_col]++,s[t.graph_col].is_show=o[t.graph_col]?1:0)}),this.seatInit=Object(n["a"])({},this.seatInit,{row:e.length,col:s.length,rowSort:e[0]-e[1]>0?"bt":"tb",colSort:s[0]-s[1]>0?"rl":"lr"}),this.seatArr=r,this.markCol=s,this.markRow=e},changeScreen:function(t){var e=this;this.currentScreenId=this.seatInit.screen_id=t,this.seatArr=[],this.markCol=[],this.markRow=[],w({screen_id:t}).then(function(t){var s=t.data,r=t.code,a=t.msg;1!=r?e.formatSeat(s):e.$message.error(a)})}}},x=g,y=(s("6997"),Object(h["a"])(x,r,a,!1,null,null,null));e["default"]=y.exports},a3ba:function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-button",{attrs:{size:"medium"},on:{click:t.goBack}},[t._v("返回")])},a=[],n={data:function(){return{}},methods:{goBack:function(){this.$router.go(-1)}}},o=n,i=s("17cc"),c=Object(i["a"])(o,r,a,!1,null,"6d81d39c",null);e["a"]=c.exports},ed08:function(t,e,s){"use strict";s.d(e,"b",function(){return a}),s.d(e,"c",function(){return n}),s.d(e,"a",function(){return o});s("f763"),s("3b54"),s("df36"),s("7bc1"),s("34a3"),s("0857"),s("3d92");function r(t){return 1*t<10?"0"+t:t}var a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YMDhms",s=null;console.log(t),s="[object Date]"==Object.prototype.toString.call(t)?t:t/1e10<1?1e3*t:t;var a=new Date(s),n=a.getFullYear(),o=r(a.getMonth()+1),i=r(a.getDate()),c=r(a.getHours()),l=r(a.getMinutes()),u=r(a.getSeconds()),h=new Map([["Y",n],["M",o],["D",i],["h",c],["hm","".concat(c,":").concat(l)],["hms","".concat(c,":").concat(l,":").concat(u)],["YM","".concat(n,"-").concat(o)],["YMD","".concat(n,"-").concat(o,"-").concat(i)],["YMDhms","".concat(n,"-").concat(o,"-").concat(i," ").concat(c,":").concat(l,":").concat(u)],["YMDhm","".concat(n,"-").concat(o,"-").concat(i," ").concat(c,":").concat(l)]]);return h.get(e)},n=function(t){var e=t.replace(/-/g,"/");return new Date(e).getTime()},o=function(t,e,s){var r=s[e]?s[e]:s,a="";return t.forEach(function(s,n){s[e]==r&&(a=t.splice(n,1))}),a}}}]);