(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e614a0f"],{"152d":function(t,e,r){"use strict";var s=r("699f"),a=r.n(s);a.a},6997:function(t,e,r){"use strict";var s=r("b48f"),a=r.n(s);a.a},"699f":function(t,e,r){},"7fb7":function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"createseat"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("div",{staticClass:"pan-box"},[r("div",{staticClass:"pan-form"},[r("el-form",{staticClass:"demo-form-inline",attrs:{inline:""}},[r("el-form-item",[r("el-button",{attrs:{type:"success",size:"medium"},on:{click:t.addScreen}},[t._v("添加影厅")])],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"info",size:"medium"},on:{click:t.createSeats}},[t._v("创建座位图")])],1)],1)],1)])])],1),t._v(" "),r("div",{staticClass:"map-box"},[r("div",{staticClass:"screen-name-bar"},t._l(t.allScreenInfo,function(e,s){return r("span",{key:s,class:{active:t.currentScreenId==e._id},on:{click:function(r){return t.changeScreen(e._id)}}},[t._v(t._s(e.screen_name))])}),0),t._v(" "),r("div",{staticClass:"screen-name-show"},t._l(t.allScreenInfo,function(e,s){return e._id==t.currentScreenId?r("span",{key:s},[t._v(t._s(e.screen_name))]):t._e()}),0),t._v(" "),r("div",{staticClass:"content-box maps"},[r("table",{staticStyle:{display:"inline-block"},attrs:{width:"auto"}},[r("tr",[r("td",{attrs:{width:"40",height:"34"}},[t._v(" ")]),t._v(" "),r("td",t._l(t.markCol,function(e,s){return r("span",{key:s,staticClass:"mark-col",style:{opacity:0==e.is_show?"0":"1"}},[t._v(t._s(e.k))])}),0)]),t._v(" "),r("tr",[r("td",t._l(t.markRow,function(e,s){return r("span",{key:s,staticClass:"mark-row",style:{opacity:0==e.is_show?"0":"1"}},[t._v(t._s(e.k))])}),0),t._v(" "),r("td",t._l(t.seatArr,function(e,s){return r("div",{key:s,staticClass:"row-cloumn"},t._l(e,function(e,s){return r("span",{key:s,staticClass:"col-cloumn",style:{opacity:0==e.is_show?"0":"1"},attrs:{"data-_x":e.graph_col,"data-_y":e.graph_row,"data-_fixed_x":e.fixed_x,"data-_fixed_y":e.fixed_y},on:{click:function(e){return t.drawSeat(e)}}},[t._v(t._s(e.seat_row)+"排"+t._s(e.seat_col))])}),0)}),0)])])])]),t._v(" "),r("div",{staticStyle:{position:"absolute",left:"20px",bottom:"40px"}},[r("goBack"),t._v(" "),r("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.submitSeat}},[t._v("保存")])],1),t._v(" "),r("inputBox",{attrs:{isBoxShow:t.isScreenBox,title:t.boxTitle},on:{"update:isBoxShow":function(e){t.isScreenBox=e},"update:is-box-show":function(e){t.isScreenBox=e},hideBox:t.dataHide}},[r("div",{directives:[{name:"show",rawName:"v-show",value:0==t.isSeatOrScreen,expression:"isSeatOrScreen == 0"}],staticClass:"form-wrap"},[r("el-form",{attrs:{"label-position":"right","label-width":"100px"}},[r("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"影厅名称"}},[r("el-input",{attrs:{size:"medium"},model:{value:t.screenInfo.screen_name,callback:function(e){t.$set(t.screenInfo,"screen_name",e)},expression:"screenInfo.screen_name"}})],1),t._v(" "),r("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"影厅类型"}},[r("el-select",{attrs:{size:"medium",placeholder:"请选择"},model:{value:t.screenInfo.screen_type,callback:function(e){t.$set(t.screenInfo,"screen_type",e)},expression:"screenInfo.screen_type"}},[r("el-option",{attrs:{label:"普通",value:"普通"}}),t._v(" "),r("el-option",{attrs:{label:"旗舰",value:"旗舰"}})],1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"音响类型",placeholder:"请选择"}},[r("el-select",{attrs:{size:"medium"},model:{value:t.screenInfo.sound_type,callback:function(e){t.$set(t.screenInfo,"sound_type",e)},expression:"screenInfo.sound_type"}},[r("el-option",{attrs:{label:"普通",value:"普通"}}),t._v(" "),r("el-option",{attrs:{label:"高端",value:"高端"}})],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"状态"}},[r("el-switch",{attrs:{size:"medium"},model:{value:t.screenInfo.screen_status,callback:function(e){t.$set(t.screenInfo,"screen_status",e)},expression:"screenInfo.screen_status"}})],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.submitScreen}},[t._v("添加")]),t._v(" "),r("el-button",{attrs:{size:"medium"},on:{click:t.cancelScreen}},[t._v("取消")])],1)],1)],1),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:1==t.isSeatOrScreen,expression:"isSeatOrScreen == 1"}],staticClass:"form-wrap"},[r("el-form",{attrs:{"label-position":"right","label-width":"100px"}},[r("el-form-item",{attrs:{label:"座位布局"}},[r("el-row",[r("el-col",{attrs:{span:9}},[r("el-input",{attrs:{size:"medium"},model:{value:t.seatInit.row,callback:function(e){t.$set(t.seatInit,"row",e)},expression:"seatInit.row"}})],1),t._v(" "),r("el-col",{attrs:{span:3}},[t._v("  排")]),t._v(" "),r("el-col",{attrs:{span:9}},[r("el-input",{attrs:{size:"medium"},model:{value:t.seatInit.col,callback:function(e){t.$set(t.seatInit,"col",e)},expression:"seatInit.col"}})],1),t._v(" "),r("el-col",{attrs:{span:3}},[t._v("  列")])],1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"座位排序",placeholder:"请选择"}},[r("el-select",{attrs:{size:"medium"},model:{value:t.seatInit.rowSort,callback:function(e){t.$set(t.seatInit,"rowSort",e)},expression:"seatInit.rowSort"}},[r("el-option",{attrs:{label:"从上至下",value:"tb"}}),t._v(" "),r("el-option",{attrs:{label:"从下至上",value:"bt"}})],1)],1),t._v(" "),r("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"座位列序",placeholder:"请选择"}},[r("el-select",{attrs:{size:"medium"},model:{value:t.seatInit.colSort,callback:function(e){t.$set(t.seatInit,"colSort",e)},expression:"seatInit.colSort"}},[r("el-option",{attrs:{label:"从左至右",value:"lr"}}),t._v(" "),r("el-option",{attrs:{label:"从右至左",value:"rl"}})],1)],1),t._v(" "),r("el-form-item",[r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.initMap}},[t._v("确定")]),t._v(" "),r("el-button",{attrs:{size:"medium"},on:{click:t.cancelScreen}},[t._v("取消")])],1)],1)],1)])],1)},a=[],n=(r("2338"),r("fb37"),r("a506")),o=(r("f763"),r("7364"),r("63ff"),r("e71e")),i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.isBoxShow?r("div",{staticClass:"input-box-shade"},[r("div",{staticClass:"input-box"},[r("div",{staticClass:"input-title-bar"},[t._v(t._s(t.title)),r("i",{staticClass:"input-box-close el-message-box__close el-icon-close",on:{click:t.closeBox}})]),t._v(" "),r("div",{staticClass:"input-wrap"},[t._t("default")],2)])]):t._e()},c=[],l={data:function(){return{}},props:{isBoxShow:{type:Boolean,default:!1},title:{type:String,default:"提示"}},methods:{closeBox:function(){this.$emit("hideBox",!1)}},mounted:function(){}},u=l,h=(r("152d"),r("6691")),f=Object(h["a"])(u,i,c,!1,null,"b12687a2",null),_=f.exports,d=r("b775");function m(t){return Object(d["a"])({url:"/api/addScreen",method:"post",data:t})}function p(t){return Object(d["a"])({url:"/api/getScreen",method:"get",params:t})}function v(t){return Object(d["a"])({url:"/api/addSeat",method:"post",data:t})}function w(t){return Object(d["a"])({url:"/api/getSeat",method:"post",data:t})}var b=function(t){var e=t.row,r=t.col,s=t.rowSort,a=t.colSort,n=t.screen_id,o=s+a,i=[],c=[];switch(o){case"tblr":return l();case"tbrl":return u();case"btlr":return h();case"btrl":return f()}function l(){var t={},s=null,a=null;for(s=0;s<e;s++){var o=[];for(i.push({k:s+1,is_show:1}),a=0;a<r;a++)o.push({seat_col:a+1,seat_row:s+1,graph_col:a,graph_row:s,fixed_x:s+1,fixed_y:a+1,seat_status:0,is_show:1,screen_id:n}),c.push({k:a+1,is_show:1});t[s]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}function u(){var t={},s=null,a=null;for(s=0;s<e;s++){var o=[];for(i.push({k:s+1,is_show:1}),a=r;a>0;a--)o.push({seat_col:a,seat_row:s+1,graph_col:r-a,graph_row:s,fixed_x:s+s+1,fixed_y:a+a,seat_status:0,is_show:1,screen_id:n}),c.push({k:a,is_show:1});t[s]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}function h(){var t={},s=null,a=null;for(s=e;s>0;s--){var o=[];for(i.push({k:s,is_show:1}),a=0;a<r;a++)o.push({seat_col:a+1,seat_row:s,graph_col:a,graph_row:e-s,fixed_x:s,fixed_y:a+1,seat_status:0,is_show:1,screen_id:n}),c.push({k:a+1,is_show:1});t[e-s]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}function f(){var t={},s=null,a=null;for(s=e;s>0;s--){var o=[];for(i.push({k:s,is_show:1}),a=r;a>0;a--)o.push({seat_col:a,seat_row:s,graph_col:r-a,graph_row:e-s,fixed_x:s,fixed_y:a,seat_status:0,is_show:1,screen_id:n}),c.push({k:a,is_show:1});t[e-s]=o}return{seats:t,markRow:i,markCol:k(c,"k")}}},k=function(t,e){var r={};return t.reduce(function(t,s){return!r[s[e]]&&(r[s[e]]=t.push(s)),t},[])},S=(r("ed08"),r("a3ba"));function g(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,s)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?g(r,!0).forEach(function(e){Object(n["a"])(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):g(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var y={components:{inputBox:_,goBack:S["a"]},data:function(){return{listLoading:!0,isScreenBox:!1,boxTitle:"提示",screenInfo:{screen_name:"",screen_type:"",sound_type:"",screen_status:!0,cinema_id:""},allScreenInfo:[],cinema_id:"",currentScreenId:"",isSeatOrScreen:null,seatInit:{row:5,col:4,rowSort:"tb",colSort:"lr",screen_id:""},seatArr:[],markCol:[],markRow:[]}},mounted:function(){this.cinema_id=this.$route.query.cinema_id||"",this.getScreenList()},methods:{addScreen:function(){this.isSeatOrScreen=0,this.isScreenBox=!0,this.screenInfo.cinema_id=this.cinema_id},cancelScreen:function(){this.isScreenBox=!1},dataHide:function(t){this.isScreenBox=t},submitScreen:function(){var t=this;m(this.screenInfo).then(function(e){var r=e.msg;e.data;for(var s in t.cancelScreen(),t.getScreenList(),t.screenInfo)"screen_status"!=s&&(t.screenInfo[s]="");t.$message({message:r,type:"success"})})},getScreenList:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p({cinema_id:this.cinema_id}).then(function(t){var r=t.data,s=t.code,a=t.msg;1==s?e.$message({message:a,type:"error"}):(e.allScreenInfo=r.screen,e.currentScreenId=e.seatInit.screen_id=r.screen[0]._id,e.formatSeat(r.seat))});case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),createSeats:function(){this.isSeatOrScreen=1,this.isScreenBox=!0},initMap:function(){var t=b(this.seatInit);this.seatArr=t.seats,this.markCol=t.markCol,this.markRow=t.markRow,this.cancelScreen()},drawSeat:function(t){var e=this,r=this.seatInit.rowSort+this.seatInit.colSort,s=t.target.dataset,a=s._x,n=s._y,o=this.seatArr[n][a];o.is_show=0==o.is_show?1:0;var i=this.seatArr[n].filter(function(t){return 1==t.is_show});0==i.length?this.markRow[n].is_show=0:this.markRow[n].is_show=1;var c=0;for(var l in this.seatArr)1==this.seatArr[l][a].is_show&&c++;this.markCol[a].is_show=0==c?0:1;var u=this.markCol.filter(function(t){return 1==t.is_show}),h={tb:function(){var t=this.markRow.filter(function(t){return 1==t.is_show});t.forEach(function(t,e){t.k=e+1})},bt:function(){var t=this.markRow.filter(function(t){return 1==t.is_show});t.forEach(function(e,r){e.k=t.length-r})},lr:function(){i.forEach(function(t,e){t.seat_col=e+1}),u.forEach(function(t,e){t.k=e+1})},rl:function(){i.forEach(function(t,e){t.seat_col=i.length-e}),u.forEach(function(t,e){t.k=u.length-e})}};switch(r){case"tblr":h.tb.call(this),h.lr.call(this);break;case"tbrl":h.tb.call(this),h.rl.call(this);break;case"btlr":h.bt.call(this),h.lr.call(this);break;case"btrl":h.bt.call(this),h.rl.call(this);break}this.markRow.forEach(function(t,r){e.seatArr[r].forEach(function(e,r){e.seat_row=t.k})})},submitSeat:function(){var t=this,e=[];for(var r in this.seatArr)this.seatArr[r].forEach(function(e){e.fixed_y=t.markCol[e.graph_col].k,e.fixed_x=t.markRow[e.graph_row].k}),e=e.concat(this.seatArr[r]);v({seat:e}).then(function(e){var r=e.msg,s=e.data;t.formatSeat(s),t.$message({message:r,type:"success"})})},formatSeat:function(t){var e=[],r=[],s={},a={},n={};t.forEach(function(t,o){s[t.graph_row]?s[t.graph_row].push(t):s[t.graph_row]=[t],void 0===a[t.graph_row]?1==t.is_show?(a[t.graph_row]=1,e.push({k:t.fixed_x})):(a[t.graph_row]=0,e.push({k:t.fixed_x})):(1==t.is_show&&a[t.graph_row]++,e[t.graph_row].is_show=a[t.graph_row]?1:0),void 0===n[t.graph_col]?1==t.is_show?(n[t.graph_col]=1,r.push({k:t.fixed_y})):(n[t.graph_col]=0,r.push({k:t.fixed_y})):(1==t.is_show&&n[t.graph_col]++,r[t.graph_col].is_show=n[t.graph_col]?1:0)}),this.seatInit=x({},this.seatInit,{},{row:e.length,col:r.length,rowSort:e[0]-e[1]>0?"bt":"tb",colSort:r[0]-r[1]>0?"rl":"lr"}),this.seatArr=s,this.markCol=r,this.markRow=e},changeScreen:function(t){var e=this;this.currentScreenId=this.seatInit.screen_id=t,this.seatArr=[],this.markCol=[],this.markRow=[],w({screen_id:t}).then(function(t){var r=t.data,s=t.code,a=t.msg;1!=s?e.formatSeat(r):e.$message.error(a)})}}},I=y,O=(r("6997"),Object(h["a"])(I,s,a,!1,null,null,null));e["default"]=O.exports},a3ba:function(t,e,r){"use strict";var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-button",{attrs:{size:"medium"},on:{click:t.goBack}},[t._v("返回")])},a=[],n={data:function(){return{}},methods:{goBack:function(){this.$router.go(-1)}}},o=n,i=r("6691"),c=Object(i["a"])(o,s,a,!1,null,"6d81d39c",null);e["a"]=c.exports},b48f:function(t,e,r){},ed08:function(t,e,r){"use strict";r.d(e,"b",function(){return a}),r.d(e,"c",function(){return n}),r.d(e,"a",function(){return o});r("f763"),r("3b54"),r("df36"),r("7bc1"),r("34a3"),r("0857"),r("9090");function s(t){return 1*t<10?"0"+t:t}var a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YMDhms",r=null;r="[object Date]"==Object.prototype.toString.call(t)?t:t/1e10<1?1e3*t:t;var a=new Date(r),n=a.getFullYear(),o=s(a.getMonth()+1),i=s(a.getDate()),c=s(a.getHours()),l=s(a.getMinutes()),u=s(a.getSeconds()),h=new Map([["Y",n],["M",o],["D",i],["h",c],["hm","".concat(c,":").concat(l)],["hms","".concat(c,":").concat(l,":").concat(u)],["YM","".concat(n,"-").concat(o)],["YMD","".concat(n,"-").concat(o,"-").concat(i)],["YMDhms","".concat(n,"-").concat(o,"-").concat(i," ").concat(c,":").concat(l,":").concat(u)],["YMDhm","".concat(n,"-").concat(o,"-").concat(i," ").concat(c,":").concat(l)]]);return h.get(e)},n=function(t){var e=t.replace(/-/g,"/");return new Date(e).getTime()},o=function(t,e,r){var s=r[e]?r[e]:r,a="";return t.forEach(function(r,n){r[e]==s&&(a=t.splice(n,1))}),a}}}]);